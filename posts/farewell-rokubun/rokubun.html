<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Miquel Garcia">
<meta name="dcterms.date" content="2024-12-18">
<meta name="description" content="Some takeaways that I learned during my journey as CTO at Rokubun, leading the technological strategy at the company.">

<title>On my journey as CTO at Rokubun – mgfernan</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-e36ce5c26c48eccda62d8cde5e438854.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-J0Q5PFB35Q"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-J0Q5PFB35Q', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">mgfernan</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-jocs" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Jocs</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-jocs">    
        <li>
    <a class="dropdown-item" href="../../games/status.html">
 <span class="dropdown-text">Desenvolupament de jocs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../games/cronocartes/index.html">
 <span class="dropdown-text">Cronocartes Història de Catalunya</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../games/cronocartas/index.html">
 <span class="dropdown-text">Cronocartas Historia de Galicia</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../games/torneig_cronocartes.html">
 <span class="dropdown-text">CronoTorneig</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mgfernan"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://instagram.com/cronocartes"> <i class="bi bi-instagram" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">On my journey as CTO at Rokubun</h1>
                  <div>
        <div class="description">
          Some takeaways that I learned during my journey as CTO at Rokubun, leading the technological strategy at the company.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Professional</div>
                <div class="quarto-category">English</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Miquel Garcia </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 18, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-was-rokubun" id="toc-what-was-rokubun" class="nav-link active" data-scroll-target="#what-was-rokubun">What was Rokubun?</a></li>
  <li><a href="#achievements" id="toc-achievements" class="nav-link" data-scroll-target="#achievements">Achievements</a></li>
  <li><a href="#why-we-had-to-close" id="toc-why-we-had-to-close" class="nav-link" data-scroll-target="#why-we-had-to-close">Why we had to close?</a></li>
  <li><a href="#things-that-we-did-right" id="toc-things-that-we-did-right" class="nav-link" data-scroll-target="#things-that-we-did-right">Things that we did right</a></li>
  <li><a href="#some-takeaways" id="toc-some-takeaways" class="nav-link" data-scroll-target="#some-takeaways">Some takeaways</a></li>
  <li><a href="#final-words" id="toc-final-words" class="nav-link" data-scroll-target="#final-words">Final words</a></li>
  <li><a href="#ai-usage-in-this-post" id="toc-ai-usage-in-this-post" class="nav-link" data-scroll-target="#ai-usage-in-this-post">AI usage in this post</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>For the last ten years I’ve been Chief Technological Officer (CTO) at Rokubun, a company I co-founded and co-managed with my colleague <a href="https://www.linkedin.com/in/xavierbanque/">Xavier Banque</a>. Unfortunately, we had to take the difficult decision of shutting it down.</p>
<p>Drawing on my experience at Rokubun, I’d like to share some insights and some takeaways that could hopefully help other entrepreneurs at similar fields in which we operated.</p>
<p><img src="rokubun.jpg" class="img-fluid"></p>
<section id="what-was-rokubun" class="level2">
<h2 class="anchored" data-anchor-id="what-was-rokubun">What was Rokubun?</h2>
<p>Rokubun aimed at developing navigation and positioning solutions<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> with the goal of creating a product or service that could generate recursive sales. Technological innovation was an important piece in this plan, as an engine to increase the technological and scientific capital of the company ahd keep its portfolio competitve with the new developments in the navigation ecosystem.</p>
<p>Rokubun started as a consultancy business for satellite-based navigation technology, thus leveraging our past expertise in the field. In practice, this meant that we bid for tenders issued by the European Space Agency (ESA) and other funding vehicles. In fact, Rokubun was born as part of the ESA Business Incubation Programme that was established in Barcelona in 2015.</p>
<p>We sticked to this plan and along the way we created Jason, a GNSS Post Processing Kinematic service in the cloud, as well as two hardware products: the single-frequency GNSS data logger Argonaut specifically tuned for drone applications and photogrammetry, and its dual frequency evolution MEDEA GNSS computer. Despite the various market pivots that Rokubun has undergone during this journey, our plan went well up to a certain point, until it started to show some weaknesses.</p>
</section>
<section id="achievements" class="level2">
<h2 class="anchored" data-anchor-id="achievements">Achievements</h2>
<p>While I risk sounding boastful, I’d like to share some of Rokubun’s achievements:</p>
<ul>
<li>We managed to <strong>keep operations for 10 years</strong>, including a pandemic in the middle<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</li>
<li><strong>From 2 to 14 employees</strong> in 10 years with little external investment, mostly based on organic growth through revenues from contracts and grants.</li>
<li>Earned <strong>a reputation within the navigation ecosystem</strong>. Professionals and colleagues in the sector know Rokubun, and I would venture to state that in a positive way: as a potential partner to be trusted. This helped us to build a strong professional network for the company to seek for contracts.</li>
<li>Built a <strong>streamlined process to craft winning proposals</strong>. This included a strategy and plan to quickly seek partners and build a solid consortium for a tender/grant, generate valuable technical content that demonstrated our capabilities, and set up a methodology to ease and speed up the actual proposal writing in a collaborative way with our partners.</li>
<li>Achieved a <strong>robust and company-wide software development strategy</strong>, a fundamental step to further achieve technical certifications such as ISO-26262, SOTIF, … This included a Continuous Integration and Continuous Deployment infrastructure based on Gitlab that was in the workflow of all staff. Even the ones in charge of research activities and responsibles of the company back office.</li>
</ul>
</section>
<section id="why-we-had-to-close" class="level2">
<h2 class="anchored" data-anchor-id="why-we-had-to-close">Why we had to close?</h2>
<p>In short, the main reason has been <strong>insufficient cashflow</strong>, which did not allow us to continue with operations. But, what caused this cashflow tension? There is not a single reason, but a combination of them, both external and internal. I would probably highlight the following:</p>
<ul>
<li>As the famous adage says (reworded for the point in case): <em>“Once a consultancy, always a consultancy.”</em>. Pivoting from a consultancy model to a product-based business proved to be more complex than we initially anticipated. While organic growth was part of the strategy, it ultimately limited resources dedicated to product development compared to established companies in the sector. Attracting talent and investment for product development became difficult as we lacked significant commercial traction.</li>
<li>Lack of certifications. Investing in software certification (ISO26262, SOTIF) was crucial for our long-term vision (for the type of product we wanted to develop and our target market). However, we have not been able to secure the necessary funds and time to cultivate a team mindset around achieving the certification. While initial steps were taken, achieving this goal would have required a more focused allocation of resources and a strategic team culture shift. Ultimately, this impacted our ability to access certain customers requiring specific certifications. This applied even for the process of tendering and grant preparation in various funding vehicles.</li>
<li>As a Spanish company, an uphill battle to access <a href="https://navisp.esa.int/">ESA’s NAVISP</a><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> projects that we did not manage to win. This was totally out of our control, but something that severly limited our access to funds for ESA projects in the navigation sector, specially in the last years. As you might know, these projects require the approval of ESA’s National Delegations, but despite our efforts to revert the situation, we did not manage to change our odds in accessing funds for these projects.</li>
</ul>
</section>
<section id="things-that-we-did-right" class="level2">
<h2 class="anchored" data-anchor-id="things-that-we-did-right">Things that we did right</h2>
<p>Despite all this, I believe that Rokubun’s accomplishments can be largely attributed to the following:</p>
<ul>
<li><strong>Networking</strong> as a core activity in the company. This implied participate in conferences, fairs, hackathons and workshops. It seems a rather obvious activity to do in a company, but the truth is that day-to-day activities can make you underestimate its importance. Networking will be crucial to build partnerships for consortiums, requests for quotations, find potential customers, … This brings me to the following point, <em>volunteer!</em>.</li>
<li><strong>We volunteered</strong>. A lot. Even if it implied some cost. Consider this cost as marketing expenses. This will help you build your brand and establish a positive reputation. Eventually, your efforts will pay off as your peers recognize your company’s ability to deliver and build trust. Some ideas: look for hackathons in your field and make yourself available to participate as mentor and, if cashflow allows, consider sponsorship. If you are on the technical side of things, volunteer to review scientific and technical journals and reach your network to inquire for opportunities to chair conference sessions. These activities can significantly increase your visibility and credibility.</li>
<li><strong>Be realistic on your odds to winning tenders</strong>, especially when you’re a small, early-stage company. Evaluators may perceive a higher risk in awarding projects to such firms. Consider partnering with larger companies to increase your chances of success.</li>
<li><strong>Reaching the big guys</strong>. We have been always very proactive when talking to technical responsibles from the big companies in our sector. Technical workshops where a great opportunity to mingle with them and let them know the company. Moreover, you can always “<em>play the SME card</em>”: public tenders and grants usually foster collaboration with new actors and give extra points to consortiums in which SMEs have significant presence.</li>
<li><strong>Cashflow management</strong>. As inexperienced managers as we were, specially at the beginning, one of the first (and best) decisions we took was to put in place a analytical cashflow tool. We used a simple spreadsheet for this, but we were strict and accurate on our monthly expenditure. This allowed us to make reliable predictions and properly plan ahead to estimate our runway. I know this is usual practice in company management, but it was something we were somewhat overlooking at the very beginning.</li>
<li><strong>Underpromise and overdeliver</strong> when establishing objectives and performance figures in project proposals. You will have to find a sweet spot between what is feasible and and what is attractive for the customer to get the contract. Make sure you keep in reserve those nice-to-have features that entail a higher risk (of implementation, demonstration or test). Once you have the resources within the project you will be able to develop them and give an extra value to the project outcome. Even if these features are not realized in the end, you will still be successful in the project because the expectations of all parties will be aligned.</li>
<li><strong>Compensate low salaries with perks</strong>. At Rokubun we could not pay high salaries. As a consultancy with minimal investment, we did not have the resources to pay high wages. We were aware of this, and most importantly, employees were also aware of this. Rokubun compensated this limitation with flexible working hours, more holidays, a remote work policy and (we believe) engaging projects.</li>
<li><strong>Full transparency</strong> with Rokubun’s employees. Salary scales were public for all employees, salary raise criteria and objectives were also published in our internal Wiki page so everyone was aware of them. And we always tried to provide with a quantitative update on the achievement of each objective in (more or less) regular plenary meetings.</li>
<li><strong>Four eyes see more than two</strong>. The company operated on a consensus-based model between Xavi and myself. This ensured that we considered as many possible angles and consequences of our decisions. While we initially had concerns about a potential deadlock due to our equal shareholding, this never materialized. In fact, our shared ownership encouraged open dialogue and adaptability between us, which I believe ended up as a very positive asset for the company.</li>
<li>And probably the most important point: <strong>we kept a huge whiteboard to write ideas, draw or sketch</strong>. I am really going to miss it.</li>
</ul>
<p><img src="whiteboard.jpg" class="img-fluid"></p>
</section>
<section id="some-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="some-takeaways">Some takeaways</h2>
<p>The following is a set of some topics and points to take into account for a small technological company in the technological sector:</p>
<ul>
<li><strong>Plan for project evaluation periods</strong>. Keep in mind that the resolution of grants and tenders take time. In ESA contracts (tenders) it may take a couple of months, while EUSPA and European Commission may even take a bit longer. Make sure you secure your cashflow to sustain operations during this interim period. In a similar topic, revision and approval of interim reports may take as long as 6 months in certain institutions, so make sure your cashflow can withstand these time delays.</li>
<li>In ESA projects, if in two months there is no positive answer regarding a submitted proposal, it’s likely that the contract has been given to another consortium.</li>
<li>I’ve learned this elsewhere, but is very true: “The disposition of a partner writing a proposal will be the disposition when executing a project”. Which means, if a partner is delayed providing contributions when preparing the proposal of the tender, expect delays when working in the project.</li>
<li><strong>Pivoting</strong>, hardware is expensive and unforgiving, mistakes are costly.</li>
<li><strong>“Sweets that can turn bitter”</strong>. One of our service providers used these words to describe public funds. Be careful with them, no matter how attractive they may seem. Make sure you are perfectly aware of all the conditions. There will be clauses in the fund agreement that will pass unnoticed. This is a fact. My practical recommendation? treat public funds as some sort of credit that needs to be returned at some point. Plan your cashflow in a way that you need to return between 10% and 20% of the amount granted. In this way you will be prepared for any possible incidentals you made during the audit process.</li>
<li><strong>Team management</strong>, if you are a CTO like myself, expect very short time spans of focused work. Avoid delegating tasks that disrupt the team’s focus: be prepared to do them yourself if need be, otherwise delays will happen. Make sure to do a good planning so that unexpected tasks can be smoothly integrated into the task pipeline of the team.</li>
<li><strong>Consultancy is seasonal</strong> as far as cash source is concerned. As soon as you get a project approved, start looking for the next opportunity. Consider also a line of credit despite its associated financial cost.</li>
</ul>
</section>
<section id="final-words" class="level2">
<h2 class="anchored" data-anchor-id="final-words">Final words</h2>
<p>Working at Rokubun has been certainly a stimulating experience: a rollercoaster. It has been a a source of worries some times but a constant flow of learning experiences and I value, in particular, the social aspect of this adventure: the people I met and the pleasure to work side-by-side with very talented professionals.</p>
</section>
<section id="ai-usage-in-this-post" class="level2">
<h2 class="anchored" data-anchor-id="ai-usage-in-this-post">AI usage in this post</h2>
<p>While I did use Gemini to polish some parts of the text (mostly style corrections and English typos), this post has been ideated, organized and written by me.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Are you familiar with satellite navigation systems (GNSS) such as GPS or Galileo?<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>This was in part due to the nature of our work, that allowed us to temporarily move our operations to a fully remote approach. However, while I appreciate the flexibility of remote work, I still believe that face-to-face meetings and discussions are essential for effective collaboration, specially with more junior profiles. This applies even for software development tasks such as pair programming and even code reviews.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>ESA NAVISP is the ESA programme for navigation-related projects.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/mgfernan\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>